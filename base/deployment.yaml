apiVersion: apps/v1
kind: Deployment
metadata:
  name: os-health-monitor
spec:
  replicas: 1
  selector:
    matchLabels:
      app: os-health-monitor
  template:
    metadata:
      labels:
        app: os-health-monitor
    spec:
      volumes:
      - name: dot-config-openstack
        secret:
          secretName: dot-config-openstack
      containers:
      - image: telegraf:1.16.3-alpine
        name: telegraf
        readinessProbe:
          httpGet:
            path: /healthz
      - image: debian:bullseye
        name: debian
        resources: {}
        volumeMounts:
        - name: dot-config-openstack
          mountPath: /root/.config/openstack
        command:
        - sh
        - -c
        - |
            set -ex
            apt-get update && apt-get install -y python3-openstackclient git
            git clone https://github.com/SovereignCloudStack/openstack-health-monitor.git
            cd openstack-health-monitor
            export OS_CLOUD=gx-scs-plusserver
            openstack server list
            sleep 10
